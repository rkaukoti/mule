<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:jms="http://www.mulesoft.org/schema/mule/transport/jms"
      xmlns="http://www.mulesoft.org/schema/mule/core"
      xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
    http://www.mulesoft.org/schema/mule/transport/jms http://www.mulesoft.org/schema/mule/transport/jms/current/mule-transport-jms.xsd">


    <jms:activemq-xa-connector name="jmsConnector1" maxRedelivery="-1" specification="1.1" numberOfConsumers="1" brokerURL="tcp://localhost:${port1}"/>
    <jms:activemq-xa-connector name="jmsConnector2" maxRedelivery="-1" specification="1.1" numberOfConsumers="1" brokerURL="tcp://localhost:${port2}"/>

    <jms:endpoint name="inboundDispatcher" queue="in" connector-ref="jmsConnector1"/>

    <jms:endpoint name="inbound" queue="in" connector-ref="jmsConnector1">
        <xa-transaction action="ALWAYS_BEGIN"/>
    </jms:endpoint>

    <jms:endpoint name="outbound" queue="out" connector-ref="jmsConnector2">
        <xa-transaction action="ALWAYS_JOIN"/>
    </jms:endpoint>

    <jms:endpoint name="outboundRequester" queue="out" connector-ref="jmsConnector2"/>

</mule>
